'use strict';

var db = require('../db/config.js');
var request = require('request');

var User = db.User;
var Movie = db.Movie;

var omdb = 'http://www.omdbapi.com/?';

module.exports = {
  addMovie: function addMovie(req, res, next) {
    var movie = req.body.movie;
    var url = omdb + 'tomatoes=true&t=' + movie;
    request(url, function (err, response, body) {
      console.log('THIS IS THE URL: ', url);
      if (err) {
        console.log('error from omdb request: ', err);
      } else {
        var data = JSON.parse(response.body);
        var info = {
          title: data.Title,
          year: data.Year,
          img: data.Poster,
          length: data.Runtime,
          plot: data.Plot,
          rating: data.tomatoUserRating
        };
        new Movie(info).save();
      }
    });
    // new Movie({title: req.body.movie}).save();
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2ZXIvaGFuZGxlcnMuanMiXSwibmFtZXMiOlsiZGIiLCJyZXF1aXJlIiwicmVxdWVzdCIsIlVzZXIiLCJNb3ZpZSIsIm9tZGIiLCJtb2R1bGUiLCJleHBvcnRzIiwiYWRkTW92aWUiLCJyZXEiLCJyZXMiLCJuZXh0IiwibW92aWUiLCJib2R5IiwidXJsIiwiZXJyIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsImluZm8iLCJ0aXRsZSIsIlRpdGxlIiwieWVhciIsIlllYXIiLCJpbWciLCJQb3N0ZXIiLCJsZW5ndGgiLCJSdW50aW1lIiwicGxvdCIsIlBsb3QiLCJyYXRpbmciLCJ0b21hdG9Vc2VyUmF0aW5nIiwic2F2ZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxLQUFLQyxRQUFRLGlCQUFSLENBQVQ7QUFDQSxJQUFJQyxVQUFVRCxRQUFRLFNBQVIsQ0FBZDs7QUFFQSxJQUFJRSxPQUFPSCxHQUFHRyxJQUFkO0FBQ0EsSUFBSUMsUUFBUUosR0FBR0ksS0FBZjs7QUFFQSxJQUFJQyxPQUFPLDBCQUFYOztBQUVBQyxPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZDLFlBQVUsa0JBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFXQyxJQUFYLEVBQW9CO0FBQzVCLFFBQUlDLFFBQVFILElBQUlJLElBQUosQ0FBU0QsS0FBckI7QUFDQSxRQUFJRSxNQUFNVCxPQUFPLGtCQUFQLEdBQTRCTyxLQUF0QztBQUNBVixZQUFRWSxHQUFSLEVBQWEsVUFBU0MsR0FBVCxFQUFjQyxRQUFkLEVBQXdCSCxJQUF4QixFQUE4QjtBQUN6Q0ksY0FBUUMsR0FBUixDQUFZLG1CQUFaLEVBQWlDSixHQUFqQztBQUNBLFVBQUlDLEdBQUosRUFBUztBQUNQRSxnQkFBUUMsR0FBUixDQUFZLDJCQUFaLEVBQXlDSCxHQUF6QztBQUNELE9BRkQsTUFFTztBQUNMLFlBQUlJLE9BQU9DLEtBQUtDLEtBQUwsQ0FBV0wsU0FBU0gsSUFBcEIsQ0FBWDtBQUNBLFlBQUlTLE9BQU87QUFDVEMsaUJBQU9KLEtBQUtLLEtBREg7QUFFVEMsZ0JBQU1OLEtBQUtPLElBRkY7QUFHVEMsZUFBS1IsS0FBS1MsTUFIRDtBQUlUQyxrQkFBUVYsS0FBS1csT0FKSjtBQUtUQyxnQkFBTVosS0FBS2EsSUFMRjtBQU1UQyxrQkFBUWQsS0FBS2U7QUFOSixTQUFYO0FBUUEsWUFBSTlCLEtBQUosQ0FBVWtCLElBQVYsRUFBZ0JhLElBQWhCO0FBQ0Q7QUFDRixLQWhCRDtBQWlCQTtBQUNEO0FBdEJjLENBQWpCIiwiZmlsZSI6ImhhbmRsZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGRiID0gcmVxdWlyZSgnLi4vZGIvY29uZmlnLmpzJyk7XG52YXIgcmVxdWVzdCA9IHJlcXVpcmUoJ3JlcXVlc3QnKTtcblxudmFyIFVzZXIgPSBkYi5Vc2VyO1xudmFyIE1vdmllID0gZGIuTW92aWU7XG5cbnZhciBvbWRiID0gJ2h0dHA6Ly93d3cub21kYmFwaS5jb20vPydcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFkZE1vdmllOiAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICB2YXIgbW92aWUgPSByZXEuYm9keS5tb3ZpZTtcbiAgICB2YXIgdXJsID0gb21kYiArICd0b21hdG9lcz10cnVlJnQ9JyArIG1vdmllO1xuICAgIHJlcXVlc3QodXJsLCBmdW5jdGlvbihlcnIsIHJlc3BvbnNlLCBib2R5KSB7XG4gICAgICBjb25zb2xlLmxvZygnVEhJUyBJUyBUSEUgVVJMOiAnLCB1cmwpO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgZnJvbSBvbWRiIHJlcXVlc3Q6ICcsIGVycik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UuYm9keSk7XG4gICAgICAgIHZhciBpbmZvID0ge1xuICAgICAgICAgIHRpdGxlOiBkYXRhLlRpdGxlLFxuICAgICAgICAgIHllYXI6IGRhdGEuWWVhcixcbiAgICAgICAgICBpbWc6IGRhdGEuUG9zdGVyLFxuICAgICAgICAgIGxlbmd0aDogZGF0YS5SdW50aW1lLFxuICAgICAgICAgIHBsb3Q6IGRhdGEuUGxvdCxcbiAgICAgICAgICByYXRpbmc6IGRhdGEudG9tYXRvVXNlclJhdGluZ1xuICAgICAgICB9XG4gICAgICAgIG5ldyBNb3ZpZShpbmZvKS5zYXZlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgICAvLyBuZXcgTW92aWUoe3RpdGxlOiByZXEuYm9keS5tb3ZpZX0pLnNhdmUoKTtcbiAgfVxufSJdfQ==